<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Station Types - Home</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f9f9f9;
      padding-left: 0;
    }
    header {
      background-color: #008000;
      padding: 15px;
      color: white;
      text-align: center;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .left-panel {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 20px;
      overflow-x: hidden;
    }
    .station-type-selector {
      background: white;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border-left: 5px solid #008000;
      max-width: 400px;
      margin: 0 auto;
      text-align: center;
    }
    .aws-info, .arg-info {
      background: white;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border-left: 5px solid #008000;
      overflow-x: auto;
      max-width: 100%;
      display: none;
    }
    h2 {
      color: #008000;
      margin-top: 0;
    }
    h2 a {
      text-decoration: none;
      color: #008000;
    }
    h2 a:hover {
      text-decoration: underline;
    }
    .indented {
      padding-left: 70px;
      display: block;
    }
    footer {
      text-align: center;
      padding: 10px;
      background: #008000;
      color: white;
      margin-top: 50px;
    }
    .data-section {
      margin-top: 40px;
      padding: 20px;
      border: 2px dashed #008000;
      background: #f1fdf1;
    }
    .data-section h3 {
      color: #008000;
      margin-bottom: 15px;
    }
    .data-section ul {
      list-style-type: none;
      padding: 0;
    }
    .data-section li {
      margin: 8px 0;
    }
    .data-section a {
      color: #006400;
      text-decoration: none;
    }
    .data-section a:hover {
      text-decoration: underline;
    }
    .station-type-selector select, .aws-info select, .arg-info select {
      width: 100%;
      max-width: 350px;
      margin: 10px auto;
      padding: 8px;
      border: 1px solid #008000;
      border-radius: 4px;
      display: block;
    }
    .aws-info table, .arg-info table {
      width: 100%;
      max-width: 100%;
      margin-top: 10px;
      border-collapse: collapse;
      display: none;
      table-layout: auto;
    }
    .aws-info th, .aws-info td, .arg-info th, .arg-info td {
      border: 1px solid #008000;
      padding: 8px;
      text-align: left;
      white-space: nowrap;
    }
    .aws-info th, .arg-info th {
      background-color: #f1fdf1;
    }
    .no-data {
      color: #888;
      font-style: italic;
      padding: 10px;
    }
    .suspected {
      color: red;
      font-weight: bold;
    }
    .action-buttons {
      white-space: nowrap;
    }
    .action-buttons button {
      display: inline-block !important;
      min-width: 50px;
    }
    .edit-btn, .delete-btn {
      padding: 4px 8px;
      margin: 0 2px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      text-decoration: none;
      display: inline-block;
    }
    .edit-btn {
      background-color: #007bff;
      color: white;
    }
    .edit-btn:hover {
      background-color: #0056b3;
    }
    .delete-btn {
      background-color: #dc3545;
      color: white;
    }
    .delete-btn:hover {
      background-color: #c82333;
    }
    .add-btn {
      background-color: #28a745;
      color: white;
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 10px 0;
      display: block;
    }
    .add-btn:hover {
      background-color: #218838;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 500px;
      border-radius: 5px;
      position: relative;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      position: absolute;
      right: 15px;
      top: 10px;
    }
    .close:hover {
      color: black;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #008000;
    }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #008000;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .form-group textarea {
      height: 60px;
      resize: vertical;
    }
    .save-btn, .cancel-btn {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .save-btn {
      background-color: #28a745;
      color: white;
    }
    .save-btn:hover {
      background-color: #218838;
    }
    .cancel-btn {
      background-color: #6c757d;
      color: white;
    }
    .cancel-btn:hover {
      background-color: #545b62;
    }
    .loading {
      text-align: center;
      color: #008000;
      font-style: italic;
    }
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      .left-panel {
        width: 100%;
      }
      .station-type-selector {
        max-width: 100%;
        padding: 15px;
      }
      .station-type-selector select, .aws-info select, .arg-info select {
        max-width: 100%;
      }
      .aws-info, .arg-info {
        padding: 15px;
      }
      .action-buttons {
        display: flex;
        flex-direction: column;
      }
      .edit-btn, .delete-btn {
        width: 100%;
        margin: 2px 0;
      }
    }
  </style>
  <!-- Include Papa Parse CDN (optional, if still needed for other features) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <!-- Include jsPDF with autoTable CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
  <!-- Include XLSX CDN for Excel parsing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <header>
    <h1>Station Maintenance</h1>
  </header>
  <div class="container">
    <div class="left-panel">
      <!-- Station Type Selector -->
      <div class="station-type-selector">
        <h2>Select Station Type</h2>
        <label for="station-type">Station Type:</label>
        <select id="station-type" onchange="toggleStationType()">
          <option value="">Select Station Type</option>
          <option value="aws">AWS</option>
          <option value="arg">ARG</option>
        </select>
      </div>
      <!-- AWS Information -->
      <div class="aws-info" id="aws-info">
        <h2>AWS Information</h2>
        <label for="aws-province">Province:</label>
        <select id="aws-province" onchange="updateAWSOptions('district')">
          <option value="">Select Province</option>
        </select>
        <label for="aws-district">District:</label>
        <select id="aws-district" onchange="updateAWSOptions('station')">
          <option value="">Select District</option>
        </select>
        <label for="aws-station">Station:</label>
        <select id="aws-station" onchange="displayAWSStationInfo()">
          <option value="">Select Station</option>
        </select>
        <div id="aws-station-details" style="display: none;">
          <h3>Available Sensors/Parameters</h3>
          <button class="add-btn" onclick="openAddSensorModal('aws')">Add Sensor</button>
          <table id="aws-sensor-table">
            <thead>
              <tr>
                <th>Sensor Type</th>
                <th>Installation Date</th>
                <th>Calibration Date</th>
                <th>Serial Number</th>
                <th>Status</th>
                <th>Checked On</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          
          <h3>Activity Log</h3>
          <button class="add-btn" onclick="openAddActivityModal('aws')">Add Activity</button>
          <table id="aws-activity-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Activity</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- ARG Information -->
      <div class="arg-info" id="arg-info">
        <h2>ARG Information</h2>
        <label for="arg-province">Province:</label>
        <select id="arg-province" onchange="updateARGOptions('district')">
          <option value="">Select Province</option>
        </select>
        <label for="arg-district">District:</label>
        <select id="arg-district" onchange="updateARGOptions('station')">
          <option value="">Select District</option>
        </select>
        <label for="arg-station">Station:</label>
        <select id="arg-station" onchange="displayARGStationInfo()">
          <option value="">Select Station</option>
        </select>
        <div id="arg-station-details" style="display: none;">
          <h3>Available Sensors/Parameters</h3>
          <button class="add-btn" onclick="openAddSensorModal('arg')">Add Sensor</button>
          <table id="arg-sensor-table">
            <thead>
              <tr>
                <th>Sensor Type</th>
                <th>Installation Date</th>
                <th>Calibration Date</th>
                <th>Serial Number</th>
                <th>Status</th>
                <th>Checked On</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          
          <h3>Activity Log</h3>
          <button class="add-btn" onclick="openAddActivityModal('arg')">Add Activity</button>
          <table id="arg-activity-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Activity</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Sensor Modal -->
  <div id="sensorModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('sensorModal')">&times;</span>
      <h3 id="sensorModalTitle">Add Sensor</h3>
      <form id="sensorForm">
        <input type="hidden" id="sensorId" value="">
        <input type="hidden" id="sensorStationType" value="">
        <input type="hidden" id="sensorStationName" value="">
        
        <div class="form-group">
          <label for="sensorType">Sensor Type:</label>
          <input type="text" id="sensorType" required>
        </div>
        
        <div class="form-group">
          <label for="installDate">Installation Date:</label>
          <input type="date" id="installDate" required>
        </div>
        
        <div class="form-group">
          <label for="calibDate">Calibration Date:</label>
          <input type="date" id="calibDate" required>
        </div>
        
        <div class="form-group">
          <label for="serialNumber">Serial Number:</label>
          <input type="text" id="serialNumber" required>
        </div>
        
        <div class="form-group">
          <label for="sensorStatus">Status:</label>
          <select id="sensorStatus" required>
            <option value="Good">Good</option>
            <option value="Fair">Fair</option>
            <option value="Poor">Poor</option>
            <option value="SUSPECTED">SUSPECTED</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="checkedOn">Checked On:</label>
          <input type="date" id="checkedOn" required>
        </div>
        
        <button type="submit" class="save-btn">Save</button>
        <button type="button" class="cancel-btn" onclick="closeModal('sensorModal')">Cancel</button>
      </form>
    </div>
  </div>

  <!-- Activity Modal -->
  <div id="activityModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('activityModal')">&times;</span>
      <h3 id="activityModalTitle">Add Activity</h3>
      <form id="activityForm">
        <input type="hidden" id="activityId" value="">
        <input type="hidden" id="activityStationType" value="">
        <input type="hidden" id="activityStationName" value="">
        
        <div class="form-group">
          <label for="activityDate">Date:</label>
          <input type="date" id="activityDate" required>
        </div>
        
        <div class="form-group">
          <label for="activityDesc">Activity Description:</label>
          <textarea id="activityDesc" required></textarea>
        </div>
        
        <button type="submit" class="save-btn">Save</button>
        <button type="button" class="cancel-btn" onclick="closeModal('activityModal')">Cancel</button>
      </form>
    </div>
  </div>

  <script>
    // Global functions for toggle and modals
    function toggleStationType() {
      const stationType = document.getElementById('station-type').value;
      const awsInfo = document.getElementById('aws-info');
      const argInfo = document.getElementById('arg-info');

      // Hide both sections by default
      awsInfo.style.display = 'none';
      argInfo.style.display = 'none';

      // Reset only the selected section
      if (stationType === 'aws') {
        document.getElementById('aws-province').value = '';
        document.getElementById('aws-district').value = '';
        document.getElementById('aws-station').value = '';
        document.getElementById('aws-district').disabled = true;
        document.getElementById('aws-station').disabled = true;
        document.getElementById('aws-station-details').style.display = 'none';
        awsInfo.style.display = 'block';
      } else if (stationType === 'arg') {
        document.getElementById('arg-province').value = '';
        document.getElementById('arg-district').value = '';
        document.getElementById('arg-station').value = '';
        document.getElementById('arg-district').disabled = true;
        document.getElementById('arg-station').disabled = true;
        document.getElementById('arg-station-details').style.display = 'none';
        argInfo.style.display = 'block';
      }
    }

    // Global modal functions
    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'block';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
      // Reset form
      const form = document.getElementById(modalId === 'sensorModal' ? 'sensorForm' : 'activityForm');
      form.reset();
      document.getElementById('sensorId').value = '';
      document.getElementById('activityId').value = '';
      document.getElementById(modalId === 'sensorModal' ? 'sensorModalTitle' : 'activityModalTitle').textContent = 
        modalId === 'sensorModal' ? 'Add Sensor' : 'Add Activity';
    }

    window.onclick = function(event) {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        if (event.target === modal) {
          closeModal(modal.id);
        }
      });
    }

    function openAddSensorModal(stationType) {
      document.getElementById('sensorStationType').value = stationType;
      document.getElementById('sensorStationName').value = 
        stationType === 'aws' ? document.getElementById('aws-station').value : 
        document.getElementById('arg-station').value;
      openModal('sensorModal');
    }

    function openAddActivityModal(stationType) {
      document.getElementById('activityStationType').value = stationType;
      document.getElementById('activityStationName').value = 
        stationType === 'aws' ? document.getElementById('aws-station').value : 
        document.getElementById('arg-station').value;
      openModal('activityModal');
    }

    function openEditSensorModal(stationType, stationName, sensor, index) {
      console.log('Opening edit sensor modal for', stationType, stationName, index);
      document.getElementById('sensorId').value = index;
      document.getElementById('sensorStationType').value = stationType;
      document.getElementById('sensorStationName').value = stationName;
      document.getElementById('sensorType').value = sensor.type || '';
      document.getElementById('installDate').value = sensor.installDate || '';
      document.getElementById('calibDate').value = sensor.calibDate || '';
      document.getElementById('serialNumber').value = sensor.serialNumber || '';
      document.getElementById('sensorStatus').value = sensor.status || 'Good';
      document.getElementById('checkedOn').value = sensor.checkedOn || '';
      document.getElementById('sensorModalTitle').textContent = 'Edit Sensor';
      openModal('sensorModal');
    }

    function openEditActivityModal(stationType, stationName, activity, index) {
      console.log('Opening edit activity modal for', stationType, stationName, index);
      document.getElementById('activityId').value = index;
      document.getElementById('activityStationType').value = stationType;
      document.getElementById('activityStationName').value = stationName;
      document.getElementById('activityDate').value = activity.date || '';
      document.getElementById('activityDesc').value = activity.activity || '';
      document.getElementById('activityModalTitle').textContent = 'Edit Activity';
      openModal('activityModal');
    }
  </script>
  <script src="tables3.js"></script>
  <footer>
    &copy; 2025 Rwanda Meteorology Agency — Station Types Summary
  </footer>
</body>
</html>